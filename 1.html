<script>
  const list = [
    {
      id: "1963141301754433539",
      processInstanceId: "1960510390286204929",
      prereviewId: "1960510390286204929",
      prereviewVersion: "1.0",
      prereviewVersionList: [
        {
          prereviewVersionName: "提交-预审版本V1.0",
          processInstanceId: "1960510390286204929",
          prereviewId: "1960510390286204929",
          prereviewVersion: "1.0",
        },
      ],
      title: "李飞-预审测试数据",
      event: "合同预审申请",
      contractName: "整体课程培训合同-预审测试",
      businessTypeId: "1811050894470541314",
      businessTypeName: "整体课程培训合同（公对公）",
      contractTypeCode: "FX.ZTCK",
      formType: "generic",
      approveStatus: "approved",
      approveStatusLabel: "审核通过",
      approveSuggestion: null,
      contractSubjectId: "1674689628684767233",
      contractSubjectName: "北京西郊宾馆有限责任公司",
      createTime: "2025-09-03 15:25:34",
      parentId: "1963141301754433538",
      node: "submitUserTask",
      nodeLabel: "呈报任务",
      approver: "28171",
      approverName: "李飞(li-fei5)",
      approverType: null,
      approverTypeLabel: "",
      approveTime: "2025-09-03 15:25:34",
      applySuggestion: "测试",
      show: true,
      processEnded: false,
      allowCancel: false,
      fileList: [],
      completeTime: null,
      children: [
        {
          id: "1963141302173863938",
          processInstanceId: "1960510390286204929",
          prereviewId: "1960510390286204929",
          prereviewVersion: "1.0",
          prereviewVersionList: [
            {
              prereviewVersionName: "提交-预审版本V1.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1960510390286204929",
              prereviewVersion: "1.0",
            },
          ],
          title: "李飞-预审测试数据",
          event: "合同预审申请",
          contractName: "整体课程培训合同-预审测试",
          businessTypeId: "1811050894470541314",
          businessTypeName: "整体课程培训合同（公对公）",
          contractTypeCode: "FX.ZTCK",
          formType: "generic",
          approveStatus: "approved",
          approveStatusLabel: "审核通过",
          approveSuggestion: "暂存",
          contractSubjectId: "1674689628684767233",
          contractSubjectName: "北京西郊宾馆有限责任公司",
          createTime: "2025-09-03 15:25:34",
          parentId: "1963141301754433539",
          node: "userTask",
          nodeLabel: "审核任务",
          approver: "63642",
          approverName: "胡贤伟(xw.hu)",
          approverType: "legal",
          approverTypeLabel: "法务",
          approveTime: "2025-09-03 15:25:34",
          applySuggestion: "测试",
          show: true,
          processEnded: false,
          allowCancel: false,
          fileList: [
            {
              id: 1963439971225878500,
              prereviewApproveId: 1963141302173864000,
              originFileName: "1.doc",
              fileName: "1.doc",
              fileUrl: "/profile/upload/2025/09/04/1_20250904111152A45015.doc",
              fileSize: 42496,
              fileType: 1,
              remark: null,
              createTime: "2025-09-04 11:12:23",
            },
          ],
          completeTime: null,
          children: [],
        },
        {
          id: "1963141302178058242",
          processInstanceId: "1960510390286204929",
          prereviewId: "1960510390286204929",
          prereviewVersion: "1.0",
          prereviewVersionList: [
            {
              prereviewVersionName: "提交-预审版本V1.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1960510390286204929",
              prereviewVersion: "1.0",
            },
          ],
          title: "李飞-预审测试数据",
          event: "合同预审申请",
          contractName: "整体课程培训合同-预审测试",
          businessTypeId: "1811050894470541314",
          businessTypeName: "整体课程培训合同（公对公）",
          contractTypeCode: "FX.ZTCK",
          formType: "generic",
          approveStatus: "pending",
          approveStatusLabel: "审核中",
          approveSuggestion: null,
          contractSubjectId: "1674689628684767233",
          contractSubjectName: "北京西郊宾馆有限责任公司",
          createTime: "2025-09-03 15:25:34",
          parentId: "1963141301754433539",
          node: "userTask",
          nodeLabel: "审核任务",
          approver: "1002964",
          approverName: "麦发强(faq.mai)",
          approverType: "other",
          approverTypeLabel: "其他业务",
          approveTime: "2025-09-03 15:25:34",
          applySuggestion: "测试",
          show: true,
          processEnded: false,
          allowCancel: false,
          fileList: [],
          completeTime: null,
          children: [],
        },
        {
          id: "1963141302178058241",
          processInstanceId: "1960510390286204929",
          prereviewId: "1960510390286204929",
          prereviewVersion: "1.0",
          prereviewVersionList: [
            {
              prereviewVersionName: "提交-预审版本V1.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1960510390286204929",
              prereviewVersion: "1.0",
            },
          ],
          title: "李飞-预审测试数据",
          event: "合同预审申请",
          contractName: "整体课程培训合同-预审测试",
          businessTypeId: "1811050894470541314",
          businessTypeName: "整体课程培训合同（公对公）",
          contractTypeCode: "FX.ZTCK",
          formType: "generic",
          approveStatus: "rejected",
          approveStatusLabel: "审核不通过",
          approveSuggestion: "不通过",
          contractSubjectId: "1674689628684767233",
          contractSubjectName: "北京西郊宾馆有限责任公司",
          createTime: "2025-09-03 15:25:34",
          parentId: "1963141301754433539",
          node: "userTask",
          nodeLabel: "审核任务",
          approver: "22084",
          approverName: "潘孝河(xh-pan1)",
          approverType: "finance",
          approverTypeLabel: "财务",
          approveTime: "2025-09-03 15:25:34",
          applySuggestion: "测试",
          show: true,
          processEnded: false,
          allowCancel: false,
          fileList: [],
          completeTime: null,
          children: [],
        },
      ],
    },
    {
      id: "1963534186085613570",
      processInstanceId: "1960510390286204929",
      prereviewId: "1960510390286204929",
      prereviewVersion: "2.0",
      prereviewVersionList: [
        {
          prereviewVersionName: "修订-预审版本V2.0",
          processInstanceId: "1960510390286204929",
          prereviewId: "1960510390286204929",
          prereviewVersion: "2.0",
        },
      ],
      title: "李飞-预审测试数据",
      event: "合同预审申请",
      contractName: "整体课程培训合同-预审测试",
      businessTypeId: "1811050894470541314",
      businessTypeName: "整体课程培训合同（公对公）",
      contractTypeCode: "FX.ZTCK",
      formType: "generic",
      approveStatus: "approved",
      approveStatusLabel: "审核通过",
      approveSuggestion: null,
      contractSubjectId: "1674689628684767233",
      contractSubjectName: "北京西郊宾馆有限责任公司",
      createTime: "2025-09-04 17:26:45",
      parentId: "1963141301754433538",
      node: "RepeatSubmit",
      nodeLabel: "重新呈报",
      approver: "28171",
      approverName: "李飞(li-fei5)",
      approverType: null,
      approverTypeLabel: "",
      approveTime: "2025-09-04 17:26:45",
      applySuggestion: "测试",
      show: true,
      processEnded: false,
      allowCancel: false,
      fileList: [],
      completeTime: null,
      children: [
        {
          id: "1963811551281954818",
          processInstanceId: "1960510390286204929",
          prereviewId: "1963811551177097217",
          prereviewVersion: "2.0",
          prereviewVersionList: [
            {
              prereviewVersionName: "修订-预审版本V2.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1963811551177097217",
              prereviewVersion: "2.0",
            },
            {
              prereviewVersionName: "提交-预审版本V1.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1960510390286204929",
              prereviewVersion: "1.0",
            },
          ],
          title: "预审-修订",
          event: "合同预审申请",
          contractName: "整体课程培训合同-预审测试",
          businessTypeId: "1811050894470541314",
          businessTypeName: "整体课程培训合同（公对公）",
          contractTypeCode: "FX.ZTCK",
          formType: "generic",
          approveStatus: "pending",
          approveStatusLabel: "审核中",
          approveSuggestion: null,
          contractSubjectId: "1674689628684767233",
          contractSubjectName: "北京西郊宾馆有限责任公司",
          createTime: "2025-09-05 11:48:54",
          parentId: "1963534186085613570",
          node: "userTask",
          nodeLabel: "审核任务",
          approver: "22084",
          approverName: "潘孝河(xh-pan1)",
          approverType: "finance",
          approverTypeLabel: "财务",
          approveTime: "2025-09-05 11:48:54",
          applySuggestion: "预审-请示意见",
          show: true,
          processEnded: false,
          allowCancel: false,
          fileList: [],
          completeTime: null,
          children: [],
        },
        {
          id: "1963811551281954819",
          processInstanceId: "1960510390286204929",
          prereviewId: "1963811551177097217",
          prereviewVersion: "2.0",
          prereviewVersionList: [
            {
              prereviewVersionName: "提交-预审版本V1.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1960510390286204929",
              prereviewVersion: "1.0",
            },
            {
              prereviewVersionName: "修订-预审版本V2.0",
              processInstanceId: "1960510390286204929",
              prereviewId: "1963811551177097217",
              prereviewVersion: "2.0",
            },
          ],
          title: "预审-修订",
          event: "合同预审申请",
          contractName: "整体课程培训合同-预审测试",
          businessTypeId: "1811050894470541314",
          businessTypeName: "整体课程培训合同（公对公）",
          contractTypeCode: "FX.ZTCK",
          formType: "generic",
          approveStatus: "pending",
          approveStatusLabel: "审核中",
          approveSuggestion: null,
          contractSubjectId: "1674689628684767233",
          contractSubjectName: "北京西郊宾馆有限责任公司",
          createTime: "2025-09-05 11:48:54",
          parentId: "1963534186085613570",
          node: "userTask",
          nodeLabel: "审核任务",
          approver: "1002964",
          approverName: "麦发强(faq.mai)",
          approverType: "other",
          approverTypeLabel: "其他业务",
          approveTime: "2025-09-05 11:48:54",
          applySuggestion: "预审-请示意见",
          show: true,
          processEnded: false,
          allowCancel: false,
          fileList: [],
          completeTime: null,
          children: [],
        },
      ],
    },
  ];
  const userId = 22084;
  var approverType = null;
  const approval = {};
  const recursive = (list) => {
    list.forEach((ele) => {
      const applyNode = {
        id: ele.id,
        prereviewId: ele.prereviewId,
        formType: ele.formType,
        contractTypeCode: ele.contractTypeCode,
        approver: ele.approver,
        applySuggestion: ele.applySuggestion,
        approverName: ele.approverName,
        prereviewVersion: ele.prereviewVersion,
        approveStatus: ele.approveStatus,
        approveSuggestion: ele.approveSuggestion,
        fileList: ele.fileList || [],
        disabledProps: ["approveStatus", "approveSuggestion"],
        prereviewVersionList: ele.prereviewVersionList,
        node: ele.node,
        readonly: true, // 发起版本是仅读的
      };
      ele.children.forEach((item) => {
        const content = {
          id: item.id,
          prereviewId: item.prereviewId,
          formType: item.formType,
          contractTypeCode: item.contractTypeCode,
          approver: item.approver,
          applySuggestion: item.applySuggestion,
          approverName: item.approverName,
          prereviewVersion: item.prereviewVersion,
          approveStatus: item.approveStatus,
          node: item.node,
          approveSuggestion: item.approveSuggestion,
          fileList:
            item.fileList.map((ele) => ({
              name: ele.originFileName,
              url: ele.fileUrl,
              fileSize: ele.fileSize,
            })) || [],
          prereviewVersionList: item.prereviewVersionList,
          disabledProps: ["applySuggestion"],
          readonly: userId != item.approver, // 当前登录人不是审批人，仅能读
        };
        // 当前登录人是审批人
        if (userId == item.approver) {
          approverType = !approverType ? item.approverType : approverType;
          //不是待审批仅读
          content.readonly = item.approveStatus != "pending";
        }

        if (approval[item.approverType]) {
          console.log(approval[item.approverType].children.map(ele => ({ ...ele })), applyNode.id)
          if (approval[item.approverType].children.findIndex((e) => e.id == applyNode.id) === -1) {
            approval[item.approverType].children.push({ ...applyNode });
          }
          approval[item.approverType].children.push(content);
        } else {
          approval[item.approverType] = {
            approverType: item.approverType,
            approverTypeLabel: item.approverTypeLabel,
            children: [{ ...applyNode }, content],
          };
        }
        if (item.children.length) {
          recursive(item.children);
        }
      });
    });
  };

  recursive(list);
  console.log(JSON.parse(JSON.stringify(approval)));
  const list1 = [];
  for (let k in approval) {
    approval[k].children = approval[k].children.reverse();
  }
  if (approval.finance) {
    list1.push(approval.finance);
  }
  if (approval.legal) {
    list1.push(approval.legal);
  }
  if (approval.other) {
    list1.push(approval.other);
  }
  console.log(approval, list1);

</script>